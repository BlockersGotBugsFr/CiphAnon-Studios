<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CiphAnon Studios</title>
<style>
  /* === Your original page styles (kept exactly as provided earlier) === */
  body {
    margin:0; padding:0; font-family: Inter, Arial, sans-serif;
    background: #0e0e0e;
    color:#fff; text-align:center;
    min-height:100vh;
  }
  header {
    padding: 20px; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
    font-size: 1.8em; font-weight: bold; letter-spacing: 1px;
    text-shadow: 0 2px 6px rgba(0,0,0,0.5);
    position: sticky; top:0; z-index:1000;
  }
  nav {
    background:#111; display:flex; justify-content:center; gap:20px; padding:10px 0;
    position: sticky; top:60px; z-index:999;
  }
  nav a {
    color:#ff9f1c; text-decoration:none; font-weight:bold; padding:6px 12px;
    border-radius:6px; transition: background 0.2s;
  }
  nav a:hover { background:#222; }

  section {
    padding:50px 20px;
    max-width:1200px; margin:auto;
  }
  section h2 {
    font-size:2em; margin-bottom:25px; color:#ff9f1c;
    text-shadow:0 2px 8px rgba(0,0,0,0.6);
  }

  .items-container {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:25px;
  }
  .item-card {
    background: rgba(255,255,255,0.05);
    padding:25px;
    border-radius:16px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.6);
    transition: transform 0.25s, box-shadow 0.25s, background 0.25s;
    cursor:pointer;
    display:flex; flex-direction:column; align-items:center;
  }
  .item-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 16px 40px rgba(0,0,0,0.7);
    background: rgba(255,255,255,0.08);
  }
  .item-card h3 { margin:0 0 12px; font-size:1.4em; color:#ff9f1c; }
  .item-card p { font-size:0.95em; color:#ccc; margin-bottom:20px; }
  .item-card button {
    background: black;
    border:none; padding:10px 18px; border-radius:8px;
    color:#ff9f1c; font-weight:700; cursor:pointer; font-size:0.95em;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .item-card button:hover {
    transform: translateY(-3px);
    box-shadow:0 10px 25px rgba(0,0,0,0.4);
  }
</style>
</head>
<body>

<header>CiphAnon Studios | G-S-M-D</header>
<button onclick="window.location.href='../index.html'">Go To Home</button>

<nav>
  <a href="#g">G</a>
  <a href="#s">S</a>
  <a href="#m">M</a>
  <a href="#d">D</a>
</nav>

<!-- G Section -->
<section id="g">
  <h2>G</h2>
  <div class="items-container">
    <div class="item-card">
      <h3>G 001</h3>
      <p>Blank</p>
      <button onclick="openExternal('https://example.com/game1')">P</button>
    </div>
    <div class="item-card">
      <h3>G 002</h3>
      <p>Blank</p>
      <button onclick="openExternal('https://example.com/game2')">P</button>
    </div>
  </div>
</section>

<!-- S Section -->
<section id="s">
  <h2>S</h2>
  <div class="items-container">
    <div class="item-card">
      <h3>001</h3>
      <p>Blank</p>
      <button onclick="openExternal('https://supergisfire.com.cdn.cloudflare.net/')">Open</button>
    </div>
    <div class="item-card">
      <h3>002</h3>
      <p>Blank</p>
      <button onclick="openExternal('https://www.algebra.casa/')">Open</button>
    </div>
  </div>
</section>

<!-- M Section -->
<section id="m">
  <h2>M</h2>
  <div class="items-container">
    <div class="item-card">
      <h3>M 001</h3>
      <p>Blank</p>
      <button onclick="openExternal('https://example.com/movie1')">W</button>
    </div>
  </div>
</section>

<!-- D Section -->
<section id="d">
  <h2>D</h2>
  <div class="items-container">
    <div class="item-card">
      <h3>001</h3>
      <p>Blank</p>
      <button onclick="openExternal('https://example.com/file1')">D</button>
    </div>
  </div>
</section>

<!-- ============================
     openExternal function (extended)
     - writes the popup markup (topbar + iframe + overlay)
     - then from the opener attaches the video and handlers inside the popup
   ============================ -->
<script>
function openExternal(url){
  // open about:blank popup
  const win = window.open('about:blank', '_blank', 'width=1000,height=700');

  // Popup HTML: keep topbar + iframe markup exactly as you expect
  const popupHTML = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>CiphAnon Studios</title>
      <style>
        body { margin:0; display:flex; flex-direction:column; height:100vh; background: orange; color: white; font-family:Inter, Arial, sans-serif; }
        iframe { flex:1; border:none; width:100%; display:none; } /* hidden until video ends */
        .topbar { padding:12px 20px; background: black; display:flex; justify-content:space-between; align-items:center; font-weight:bold; color: orange; position:relative; z-index:5; }
        .topbar button { padding:6px 14px; border:none; border-radius:6px; background:#071018; color:#ff9f1c; cursor:pointer; font-weight:bold; transition: transform 0.15s; }
        .topbar button:hover { transform: translateY(-2px); background:#333; }

        /* video overlay styles */
        #videoOverlay {
          position:fixed; top:0; left:0; width:100%; height:100%;
          background:black; z-index:1000; display:flex; justify-content:center; align-items:center;
          transition: opacity 1s ease;
        }
        #videoOverlay video { width:100%; height:100%; object-fit:cover; }
      </style>
    </head>
    <body>
      <div class="topbar">
        <button id="closeLeft">✖</button>
        <span>CiphAnon Studios</span>
        <button id="closeRight">Close</button>
      </div>

      <!-- overlay will be filled with video element by opener script -->
      <div id="videoOverlay"></div>

      <!-- iframe loading external url (kept hidden until overlay removed) -->
      <iframe id="siteFrame" src="${url}"></iframe>
    </body>
    </html>
  `;

  // write popup content
  win.document.open();
  win.document.write(popupHTML);
  win.document.close();

  // compute absolute video URL relative to this page (ensures correct path even on GitHub Pages)
  const videoSrc = new URL('assets/Studios Animation.mp4', location.href).href;

  // wait until popup document is ready, then attach handlers and create video element inside popup
  const checkReady = setInterval(() => {
    try {
      if (!win || win.closed) {
        clearInterval(checkReady);
        return;
      }
      const doc = win.document;
      if (!doc || !doc.body) return;

      // the markup exists — stop polling
      clearInterval(checkReady);

      // 1) Wire close buttons inside popup
      const closeLeft = doc.getElementById('closeLeft');
      const closeRight = doc.getElementById('closeRight');
      if (closeLeft) closeLeft.addEventListener('click', () => win.close());
      if (closeRight) closeRight.addEventListener('click', () => win.close());

      // 2) Create and append the video element into the overlay
      const overlay = doc.getElementById('videoOverlay');
      const video = doc.createElement('video');

      // attributes required for autoplay on modern browsers
      video.src = videoSrc;
      video.autoplay = true;
      video.muted = true;
      video.playsInline = true;
      video.setAttribute('id', 'introVideo');

      // append
      overlay.appendChild(video);

      // ensure attempt to play (some browsers require user gesture; muted helps)
      const p = video.play();
      if (p && p.catch) p.catch(() => { /* ignore play errors */ });

      // function to hide overlay and show iframe
      function hideOverlay(){
        overlay.style.opacity = '0';
        // after fade, remove overlay and show iframe
        setTimeout(() => {
          if (overlay && overlay.parentNode) overlay.parentNode.removeChild(overlay);
          const iframe = doc.getElementById('siteFrame');
          if (iframe) iframe.style.display = 'block';
        }, 1000);
      }

      // hide when video ends
      video.addEventListener('ended', hideOverlay);

      // allow clicking overlay to skip intro
      overlay.addEventListener('click', hideOverlay);

      // also hide on pressing Escape key inside popup
      doc.addEventListener('keydown', (e) => { if (e.key === 'Escape') hideOverlay(); });

      // If the iframe's content blocks embedding (X-Frame-Options), the iframe will remain blank —
      // that's normal for sites that disallow framing.
    } catch (err) {
      // if cross-origin or timing error, stop polling
      console.error('popup setup error', err);
      clearInterval(checkReady);
    }
  }, 50);
}
</script>

</body>
</html>
